(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{182:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[a("strong",[t._v("官网教程："),a("a",{attrs:{href:"https://www.rabbitmq.com/getstarted.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("RabbitMQ Tutorials — RabbitMQ"),a("OutboundLink")],1)])]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("这些概念之间的关系可用下图简单展示：")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[t._v("使用"),a("a",{attrs:{href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker"),a("OutboundLink")],1),t._v("来快速安装")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),a("p",[t._v("在"),a("code",[t._v("docker")]),t._v("官网下载 "),a("a",{attrs:{href:"https://www.docker.com/products/docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-desktop"),a("OutboundLink")],1),t._v(", 安装。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),a("p",[t._v("推荐使用 "),a("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/mirrors",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云加速器"),a("OutboundLink")],1),t._v("，需要登录获取")]),t._v(" "),t._m(14),t._v(" "),a("p",[t._v("在 "),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker hub"),a("OutboundLink")],1),t._v("上搜索"),a("code",[t._v("rabbitmq")]),t._v("，在"),a("code",[t._v("tag")]),t._v("中找到带有"),a("code",[t._v("management")]),t._v("的版本。下载镜像，启动容器：")]),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("访问地址："),a("a",{attrs:{href:"http://127.0.0.1:15672",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:15672"),a("OutboundLink")],1),t._v("，进入RabbitMQ的management页面如下：")]),t._v(" "),a("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-management.png",alt:"image-20200922221508955"}}),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._m(37),t._v(" "),t._m(38),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),a("p",[t._v("以下内容摘自官网：")]),t._v(" "),a("blockquote",[t._m(47),t._v(" "),a("p",[t._v("Each mirrored queue consists of one "),a("em",[t._v("master")]),t._v(" and one or more "),a("em",[t._v("mirrors")]),t._v(". The master is hosted on one node commonly referred as the master node. Each queue has its own master node. All operations for a given queue are first applied on the queue's master node and then propagated to mirrors. This involves enqueueing publishes, delivering messages to consumers, tracking "),a("a",{attrs:{href:"https://www.rabbitmq.com/confirms.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("acknowledgements from consumers"),a("OutboundLink")],1),t._v(" and so on.")]),t._v(" "),a("p",[t._v("Queue mirroring implies "),a("a",{attrs:{href:"https://www.rabbitmq.com/clustering.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("a cluster of nodes"),a("OutboundLink")],1),t._v(". It is therefore not recommended for use across a WAN (though of course, clients can still connect from as near and as far as needed).")]),t._v(" "),a("p",[t._v("Messages published to the queue are replicated to all mirrors. Consumers are connected to the master regardless of which node they connect to, with mirrors dropping messages that have been acknowledged at the master. Queue mirroring therefore enhances availability, but does not distribute load across nodes (all participating nodes each do all the work).")]),t._v(" "),a("p",[t._v("If the node that hosts queue master fails, the oldest mirror will be promoted to the new master as long as it's synchronised. "),a("a",{attrs:{href:"https://www.rabbitmq.com/ha.html#unsynchronised-mirrors",target:"_blank",rel:"noopener noreferrer"}},[t._v("Unsynchronised mirrors"),a("OutboundLink")],1),t._v(" can be promoted, too, depending on queue mirroring parameters.")])]),t._v(" "),a("blockquote",[a("p",[t._v("Mirroring parameters are configured using "),a("a",{attrs:{href:"https://www.rabbitmq.com/parameters.html#policies",target:"_blank",rel:"noopener noreferrer"}},[t._v("policies"),a("OutboundLink")],1),t._v(". A policy matches one or more queues by name (using a regular expression pattern) and contains a definition (a map of optional arguments) that are added to the total set of properties of the matching queues.")])]),t._v(" "),a("p",[t._v("policy的设置说明：")]),t._v(" "),t._m(48),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),a("p",[t._v("nginx主要配置如下：")]),t._v(" "),t._m(54),a("p",[t._v("docker启动nginx:")]),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/2c5eebfd0e95",target:"_blank",rel:"noopener noreferrer"}},[t._v("RabbitMQ：消息发送确认 与 消息接收确认（ACK）"),a("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq","aria-hidden":"true"}},[this._v("#")]),this._v(" RabbitMQ")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"简要介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简要介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" 简要介绍")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("RabbitMQ is the most widely deployed open source message broker")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/image-20200918221012190.png",alt:"image-20200918221012190"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("官网地址：https://www.rabbitmq.com/")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"几个基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#几个基本概念","aria-hidden":"true"}},[this._v("#")]),this._v(" 几个基本概念")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[a("strong",[t._v("Message")])]),t._v(" "),a("p",[a("strong",[t._v("消息")]),t._v("。消息是不具名的，它有消息头和消息体组成。消息体是不透明的，而消息头则由一系列的可选属性组成，这些属性包括"),a("code",[t._v("routing-key(路由键)、priority(相对于其他消息的优先权)、delivery-mode(指出该消息可能需要持久性存储)等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Publisher")])]),t._v(" "),a("p",[t._v("消息的"),a("strong",[t._v("生产者")]),t._v("，也是一个向交换器发布消息的客户端应用程序")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Exchange")])]),t._v(" "),a("p",[a("strong",[t._v("交换器")]),t._v("。用来接收生产者发送的消息并将这些消息路由给服务器中的队列")]),t._v(" "),a("p",[a("code",[t._v("Exchange")]),t._v("有4种类型："),a("code",[t._v("direct(默认),fanout,topic,headers")]),t._v("。不同类型的Exchange转发消息的策略有所区别")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("direct")])]),t._v(" "),a("p",[t._v("消息中的"),a("code",[t._v("routing key")]),t._v("如果和"),a("code",[t._v("Binding")]),t._v("中的"),a("code",[t._v("binding key")]),t._v("完全匹配，"),a("code",[t._v("Exchange")]),t._v("就将消息发到对应的队列中")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-direct.png",alt:"image-20200923220333230"}})])]),t._v(" "),a("li",[a("p",[a("code",[t._v("fanout")])]),t._v(" "),a("p",[t._v("每个发到"),a("code",[t._v("fanout")]),t._v("类型交换器的消息都会分到所有绑定的队列上去。不处理路由键。转发消息是最快的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-fanout.png",alt:"image-20200923220552464"}})])]),t._v(" "),a("li",[a("p",[a("code",[t._v("topic")])]),t._v(" "),a("p",[a("code",[t._v("topic")]),t._v("交换器将"),a("code",[t._v("routing key")]),t._v("和"),a("code",[t._v("binding key")]),t._v("切分成单词，这些"),a("strong",[t._v("单词之间用点隔开")]),t._v("。它同样识别两个通配符："),a("code",[t._v("#")]),t._v(", "),a("code",[t._v("*")]),t._v("。"),a("code",[t._v("#")]),t._v("匹配0个或多个单词，"),a("code",[t._v("*")]),t._v("匹配一个单词")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-topic.png",alt:"image-20200923221404501"}})])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Queue")])]),t._v(" "),a("p",[a("strong",[t._v("消息队列")]),t._v("。用来保存消息直到发送给消费者。它是消息的容器，也是消息的终点。一个消息可投入一个或多个队列。消息一直在队列里，等待消费者连接到这个队列将其取走")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Binding")])]),t._v(" "),a("p",[a("strong",[t._v("绑定")]),t._v("，用于消息队列和交换器之间的关联。一个绑定就是基于路由键将交换器和消息队列连接起来的路由规则。可以将交换器理解成一个由绑定构成的路由表。")]),t._v(" "),a("p",[a("code",[t._v("Echange")]),t._v("和"),a("code",[t._v("Queue")]),t._v("的绑定可以是多对多的关系")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Connection")])]),t._v(" "),a("p",[a("strong",[t._v("网络连接")]),t._v("，比如一个"),a("code",[t._v("TCP")]),t._v("连接")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Channel")])]),t._v(" "),a("p",[a("strong",[t._v("信道")]),t._v("。多路复用连接中的一个独立的双向数据流通道。信道是建立在真实的TCP连接内的虚拟连接，"),a("code",[t._v("AMQP")]),t._v("命令都是通过信道发出去的，不管是发布消息，订阅队列还是接收消息，这些动作都是通过信道完成。因为对于操作系统来说建立和销毁"),a("code",[t._v("TCP")]),t._v("都是非常昂贵的开销，所以引入了信道的概念，以复用一条"),a("code",[t._v("TCP")]),t._v("连接。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Consumer")])]),t._v(" "),a("p",[t._v("消息的"),a("strong",[t._v("消费者")]),t._v("，表示一个从消息队列中取得消息的客户端应用程序")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Virtual Host")])]),t._v(" "),a("p",[a("strong",[t._v("虚拟主机")]),t._v("。表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。每个"),a("code",[t._v("vhost")]),t._v("本质上就是一个mini版的"),a("code",[t._v("RabbitMQ")]),t._v("服务器，拥有自己的队列、交换器、绑定和权限机制。"),a("code",[t._v("vhost")]),t._v("是"),a("code",[t._v("AMQP")]),t._v("概率的基础，必须在连接时指定，"),a("code",[t._v("RabbitMQ")]),t._v("默认的"),a("code",[t._v("vhost")]),t._v("是"),a("code",[t._v("/")]),t._v(" "),a("em",[t._v("类似于mysql的database？")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Broker")])]),t._v(" "),a("p",[t._v("表示消息队列服务器实体")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-ralation.png",alt:"image-20200922225402224"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装docker","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装docker")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("开发环境为win10")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置docker镜像加速器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置docker镜像加速器","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置docker镜像加速器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Settings -> Docker Engine -> configuration")]),this._v(" ,  添加以下json：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://XXXXXXXX.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 阿里云镜像加速器(已隐藏")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://hub-mirror.c.163.com"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 网易云加速器")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"debug"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"experimental"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用docker安装rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用docker安装rabbitmq","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用docker安装RabbitMQ")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载最新版")]),t._v("\ndocker pull rabbitmq:management\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看镜像")]),t._v("\ndocker image "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器 -d: 后台运行 -p: 端口映射，将容器内的端口映射到主机端口 最后是镜像id")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v(":5672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v(":15672 --name rabbitmqcli 5726af297dd4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看容器 -a: 查看所有容器")]),t._v("\ndocker container "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -a\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在"),s("code",[this._v("docker desktop")]),this._v("上会显示当前所有的容器，同时还有一些快捷操作，省去了敲命令的麻烦：``")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/docker-desktop-container.png",alt:"image-20200922221021920"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用默认用户名和密码"),s("code",[this._v("guest/guest")]),this._v("登录：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbitmq-cli.png",alt:"image-20200922221713521"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("至此，"),s("code",[this._v("rabbitmq")]),this._v("在"),s("code",[this._v("docker")]),this._v("中安装成功")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"整合springboot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整合springboot","aria-hidden":"true"}},[this._v("#")]),this._v(" 整合SpringBoot")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"新建springboot项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建springboot项目","aria-hidden":"true"}},[this._v("#")]),this._v(" 新建"),s("code",[this._v("springboot")]),this._v("项目")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用"),s("code",[this._v("gradle")]),this._v("管理依赖，引入"),s("code",[this._v("spring-boot-starter-amqp")]),this._v(":")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("dependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compileOnly "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok:1.18.12'")]),t._v("\n    annotationProcessor "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.projectlombok:lombok:1.18.12'")]),t._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-amqp'")]),t._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-web'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testImplementation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        exclude group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.junit.vintage'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit-vintage-engine'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    testImplementation "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.springframework.amqp:spring-rabbit-test'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了方便测试，同时引入了"),s("code",[this._v("starter-web")]),this._v("和"),s("code",[this._v("starter-test")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"添加自定义配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加自定义配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加自定义配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("RabbitConfig.java")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RabbitConfig.java")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RabbitConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RabbitTemplate")]),t._v(" rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AmqpTemplate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("amqpTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用jackson 消息转换器")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageConverter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Jackson2JsonMessageConverter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 消息发送失败返回到队列中。或者yml配置 publisher-returns: true")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMandatory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setReturnCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" replyCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" replyText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" routingKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" correlationId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessageProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCorrelationId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"消息：{} 发送失败, 应答码：{} 原因：{} 交换机: {}  路由键: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" correlationId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" replyCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" replyText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" routingKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 消息确认，当消息发送到exchange时回调")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setConfirmCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("correlationData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cause"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"消息发送到exchange成功,id: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" correlationData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"消息发送到exchange失败,原因: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cause"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("application.yml")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rabbitmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publisher-returns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publisher-confirm-type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" guest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" guest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("listener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("simple")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        手动确认消息，用来保证消息消费失败时不会丢失")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("acknowledge-mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        一次消费一条，用于验证能者多劳")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"声明queue、exchange并添加绑定关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#声明queue、exchange并添加绑定关系","aria-hidden":"true"}},[this._v("#")]),this._v(" 声明Queue、Exchange并添加绑定关系")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("这里只展示direct Exchange相关的操作，其他的类似")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bookQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        return QueueBuilder.durable("bookQueue");  // 另一种声明方式')]),t._v("\n    rabbitAdmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("declareQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Queue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bookQueue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bookExchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rabbitAdmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("declareExchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DirectExchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book.direct"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bookBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rabbitAdmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("declareBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Binding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bookQueue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Binding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DestinationType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QUEUE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book.direct"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"发送、监听消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发送、监听消息","aria-hidden":"true"}},[this._v("#")]),this._v(" 发送、监听消息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("strong",[this._v("编写test文件，使用"),s("code",[this._v("RabbitTemplate")]),this._v("循环往exchange发送200条数据")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RabbitTemplate")]),t._v(" rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testDirectExchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        rabbitTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("convertAndSend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book.direct"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[this._v("使用"),s("code",[this._v("RabbitListener")]),this._v("，监听队列消息")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RabbitListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queues "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bookQueue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bookListener1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Channel")]),t._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 手动确认消息模式下，必须对消息进行应答")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("basicAck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessageProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDeliveryTag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"listener1 receive a message: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBody")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RabbitListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queues "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bookQueue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bookListener2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Channel")]),t._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("basicAck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessageProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDeliveryTag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"listener2 receive a message: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBody")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("默认情况下如果一个 Message 被消费者所正确接收则会被从 Queue 中移除")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[a("strong",[t._v("能者多劳")])]),t._v(" "),a("p",[t._v("上面定义了两个listener，监听同一个"),a("code",[t._v("queue")]),t._v("，表示有两个消费者进行消费。其中"),a("code",[t._v("listener1")]),t._v("中添加了一个"),a("code",[t._v("Thread.sleep(1000)")]),t._v("，"),a("code",[t._v("listener2")]),t._v("中没有，用于模拟不同消费者处理快慢的情况。默认情况下， "),a("code",[t._v("rabbitmq")]),t._v("会平均分配消息给各个消费者。通过设置"),a("code",[t._v("spring.rabbitmq.listener.simple.prefetch: 1")]),t._v("， 一次只发给消费者一条消息，来实现能者多劳。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("消息确认机制")])]),t._v(" "),a("p",[t._v("有三种消息确认机制")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("AcknowledgeMode.NONE")])]),t._v(" "),a("li",[a("code",[t._v("AcknowledgeMode.AUTO")])]),t._v(" "),a("li",[a("code",[t._v("AcknowledgeMode.MANUAL")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/lwsmilence/image-hub/raw/master/rabbit-acknowledgeMode.png",alt:"image-20201019202128024"}})]),t._v(" "),a("p",[t._v("为了保证消息正常消费，采用"),a("code",[t._v("manual")]),t._v("的方式确认消息。当消息正常消费时，调用函数："),a("code",[t._v("channel.basicAck")]),t._v("，该条消息就会从队列中删除。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("mandatory")])]),t._v(" "),a("p",[t._v("在消息没有被路由到合适队列情况下会将消息返还给消息发布者。以下是几种示例：")]),t._v(" "),a("ul",[a("li",[t._v("创建了"),a("code",[t._v("exchange")]),t._v("但是未绑定"),a("code",[t._v("queue")])]),t._v(" "),a("li",[a("code",[t._v("routingKey")]),t._v("和"),a("code",[t._v("bindingKey")]),t._v("不一致")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群部署","aria-hidden":"true"}},[this._v("#")]),this._v(" 集群部署")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动容器")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker run -d --hostname rabbitmq1 --name rabbitmq-cluster1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v(":15672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v(":5672 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RABBITMQ_ERLANG_COOKIE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rabbitmqCookie'")]),t._v(" 5726af297dd4\ndocker run -d --hostname rabbitmq2 --name rabbitmq-cluster2 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15673")]),t._v(":15672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5673")]),t._v(":5672 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RABBITMQ_ERLANG_COOKIE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rabbitmqCookie'")]),t._v(" --link rabbitmq-cluster1:rabbitmq1  5726af297dd4\ndocker run -d --hostname rabbitmq3 --name rabbitmq-cluster3 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15674")]),t._v(":15672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5674")]),t._v(":5672 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RABBITMQ_ERLANG_COOKIE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rabbitmqCookie'")]),t._v(" --link rabbitmq-cluster1:rabbitmq1 --link rabbitmq-cluster2:rabbitmq2  5726af297dd4\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"容器节点加入集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器节点加入集群","aria-hidden":"true"}},[this._v("#")]),this._v(" 容器节点加入集群")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[a("p",[t._v("第一个容器")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it rabbitmq-cluster1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqctl start_app\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("第二个容器加入")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it rabbitmq-cluster2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqctl join_cluster --ram rabbit@rabbitq1\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("第三个容器加入")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it rabbitmq-cluster3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqctl join_cluster --ram rabbit@rabbitq1\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n")])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"同步策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步策略","aria-hidden":"true"}},[this._v("#")]),this._v(" 同步策略")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("By default, contents of a queue within a RabbitMQ cluster are located on a single node (the node on which the queue was declared). This is in contrast to exchanges and bindings, which can always be considered to be on all nodes. Queues can optionally be made "),s("em",[this._v("mirrored")]),this._v(" across multiple nodes.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-markdown extra-class"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[this._v("$ rabbitmqctl set_policy [-p Vhost] Name Pattern Definition [Priority]\n\n-p Vhost: 可选参数，针对指定vhost下的queue进行设置\nName: policy的名称\nPattern: queue的匹配模式(正则表达式)\nDefinition: 镜像定义，包括三个部分ha-mode, ha-params, ha-sync-mode\n    ha-mode: 指明镜像队列的模式，有效值为 all/exactly/nodes\n        all: 表示在集群中所有的节点上进行镜像\n        exactly: 表示在指定个数的节点上进行镜像，节点的个数由ha-params指定\n        nodes: 表示在指定的节点上进行镜像，节点名称通过ha-params指定\n    ha-params: ha-mode模式需要用到的参数\n    ha-sync-mode: 进行队列中消息的同步方式，有效值为automatic和manual\npriority: 可选参数，policy的优先级\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("以下命令将所有"),s("code",[this._v("queue")]),this._v(" "),s("strong",[this._v("自动")]),this._v("同步到集群的所有节点")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("rabbitmqctl set_policy policy-all "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"^"')]),this._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('\'{"ha-mode":"all","ha-sync-mode":"automatic"}\'')]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡","aria-hidden":"true"}},[this._v("#")]),this._v(" 负载均衡")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用"),s("code",[this._v("nginx")]),this._v("来实现负载均衡。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("nginx从1.9.0版本开始，新增了ngx_stream_core_module模块，使nginx支持四层负载均衡")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /root/lws/nginx-rabbit.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#rabbitmq管理界面  七层负载均衡")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" rabbitManage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15673")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15674")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15675")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rabbitManage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rabbitmq通信 四层负载均衡")]),t._v("\nstream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" rabbitTcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5673")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.67")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".47")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5674")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5675")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" rabbitTcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("docker run -d -it -p "),s("span",{pre:!0,attrs:{class:"token number"}},[this._v("15675")]),this._v(":15675 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[this._v("5675")]),this._v(":5675 --name nginx-rabbit-1 -v /root/lws/nginx-rabbit.conf:/etc/nginx/nginx.conf --privileged nginx\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("-v")]),this._v("参数将指定的配置文件替换为默认配置文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("访问 10.67.47.44:15675 可访问"),s("code",[this._v("rabbitmq management")]),this._v("，访问 10.67.47.44:5675 连接"),s("code",[this._v("rabbitmq")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"ha"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ha","aria-hidden":"true"}},[this._v("#")]),this._v(" HA")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("使用keepalived来实现HA")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资料")])}],!1,null,null,null);s.default=e.exports}}]);