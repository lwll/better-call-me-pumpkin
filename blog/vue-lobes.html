<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-lobes | better-call-me-pumpkin</title>
    <meta name="description" content="Recording...">
    <link rel="icon" href="/better-call-me-pumpkin/favicon.ico">
    
    <link rel="preload" href="/better-call-me-pumpkin/assets/css/0.styles.9082b262.css" as="style"><link rel="preload" href="/better-call-me-pumpkin/assets/js/app.99d21adc.js" as="script"><link rel="preload" href="/better-call-me-pumpkin/assets/js/19.1de6cf5c.js" as="script"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/10.0382209d.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/11.01c419a7.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/12.96fb6f67.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/13.891cd05f.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/14.e915e9cc.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/15.dc43abf1.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/16.c4f0918a.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/17.218bd543.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/18.b383d6ff.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/2.45bca6d5.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/20.92e99b9e.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/21.a147a0a8.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/22.05c65fb9.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/23.0e5d1ee0.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/24.f1c352c0.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/3.7ffeac29.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/4.f22338a3.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/5.bb4c53e3.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/6.5b82d692.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/7.f27f30a4.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/8.a10cb67b.js"><link rel="prefetch" href="/better-call-me-pumpkin/assets/js/9.4bc13018.js">
    <link rel="stylesheet" href="/better-call-me-pumpkin/assets/css/0.styles.9082b262.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/better-call-me-pumpkin/" class="home-link router-link-active"><!----> <span class="site-name">better-call-me-pumpkin</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/better-call-me-pumpkin/" class="nav-link">首页</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/tools/" class="nav-link">小工具</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/notes/" class="nav-link">小记</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/website/" class="nav-link">网站</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/article/" class="nav-link">文章</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/essay/" class="nav-link">随笔</a></div> <a href="https://github.com/lwll/better-call-me-pumpkin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/better-call-me-pumpkin/" class="nav-link">首页</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/tools/" class="nav-link">小工具</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/notes/" class="nav-link">小记</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/website/" class="nav-link">网站</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/article/" class="nav-link">文章</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/better-call-me-pumpkin/essay/" class="nav-link">随笔</a></div> <a href="https://github.com/lwll/better-call-me-pumpkin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/better-call-me-pumpkin/blog/HTTP.html" class="sidebar-link">HTTP</a></li><li><a href="/better-call-me-pumpkin/blog/algorithm.html" class="sidebar-link">算法</a></li><li><a href="/better-call-me-pumpkin/blog/CSS Grid布局.html" class="sidebar-link">CSS Grid 网格布局</a></li><li><a href="/better-call-me-pumpkin/blog/egg-lobes.html" class="sidebar-link">egg-lobes</a></li><li><a href="/better-call-me-pumpkin/blog/element-plus.html" class="sidebar-link">element-plus源码分析</a></li><li><a href="/better-call-me-pumpkin/blog/Flink-Table-API-SQL.html" class="sidebar-link">FlinkTable API &amp; SQL</a></li><li><a href="/better-call-me-pumpkin/blog/flink笔记.html" class="sidebar-link">flink笔记</a></li><li><a href="/better-call-me-pumpkin/blog/Cassandra简述.html" class="sidebar-link">Cassandra简述</a></li><li><a href="/better-call-me-pumpkin/blog/keepalived.html" class="sidebar-link">keepalived</a></li><li><a href="/better-call-me-pumpkin/blog/Nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/better-call-me-pumpkin/blog/RabbitMQ.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/better-call-me-pumpkin/blog/" class="sidebar-link">前言</a></li><li><a href="/better-call-me-pumpkin/blog/redis.html" class="sidebar-link">redis</a></li><li><a href="/better-call-me-pumpkin/blog/TiDB简述.html" class="sidebar-link">TiDB简述</a></li><li><a href="/better-call-me-pumpkin/blog/vue-lobes.html" class="active sidebar-link">vue-lobes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#技术栈" class="sidebar-link">技术栈</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#项目运行" class="sidebar-link">项目运行</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#有关" class="sidebar-link">有关</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#开发日志" class="sidebar-link">开发日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#登录与权限" class="sidebar-link">登录与权限</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#页面自适应" class="sidebar-link">页面自适应</a></li><li class="sidebar-sub-header"><a href="/better-call-me-pumpkin/blog/vue-lobes.html#优雅地使用icon" class="sidebar-link">优雅地使用icon</a></li></ul></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue-lobes"><a href="#vue-lobes" aria-hidden="true" class="header-anchor">#</a> vue-lobes</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p><strong>本项目是一个练手性质的项目</strong>。</p> <p>本人学习vue已经有一段时间了。在学习的过程中，有看过官方的文档、示例，有学习过一些相关的知识，也有粗略看过别人的一些项目。不得不说，这段学习经历还是有收获到一些东西的，但终究有限，不管是深度还是广度都还不够，经不起推敲。</p> <p>在向妹子<a href="https://github.com/saruky1996" target="_blank" rel="noopener noreferrer">@saruky1996 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>诉说自己的烦恼，两人讨论之后决定，开始用vue写一个项目。这个项目的功能被定义为记录用户平时看的书、电影，后续可能还会添加记录游戏的功能。可以把此项目看作是一个单机极简版的<a href="https://www.douban.com/" target="_blank" rel="noopener noreferrer">豆瓣<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>+<a href="%5Bhttps://www.xiaoheihe.cn%5D(https://www.xiaoheihe.cn/)">小黑盒</a>。</p> <p>由于是在业余时间写这个项目，而且练手的性质比较重，会侧重用更多自己没用过的技术去做，所以项目的开发周期可能会拉的很长，甚至最后不一定会做完。不过在我看来，最重要的是开发的过程中学到的东西，以及让自己认识到自己还有很多很多需要学习的地方。</p> <p><strong>这篇博客用来记录自己在开发lobes的过程中遇到的各种问题</strong></p> <h2 id="技术栈"><a href="#技术栈" aria-hidden="true" class="header-anchor">#</a> 技术栈</h2> <p>vue2 + vuex + vue-router + vue-cli3 + ES6/7 + axios + sass + flex + rem + svg + iview</p> <h2 id="项目运行"><a href="#项目运行" aria-hidden="true" class="header-anchor">#</a> 项目运行</h2> <p>本地运行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> run serve
</code></pre></div><p>打包：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre></div><h2 id="有关"><a href="#有关" aria-hidden="true" class="header-anchor">#</a> 有关</h2> <p><code>本项目相应的后台使用node.js开发</code>，<a href="https://github.com/lwll/egg-lobes" target="_blank" rel="noopener noreferrer">地址在这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="开发日志"><a href="#开发日志" aria-hidden="true" class="header-anchor">#</a> 开发日志</h2> <h3 id="登录与权限"><a href="#登录与权限" aria-hidden="true" class="header-anchor">#</a> 登录与权限</h3> <blockquote><p>本项目的登录方式做了简单处理，未注册的用户登录时将自动注册 。</p></blockquote> <ul><li><strong>用户认证方式？</strong></li></ul> <p><strong>客户端保存用户的身份信息到cookie中，后台使用session进行校验</strong></p> <ol><li><p>当用户进行登录时，客户端向后台发送用户输入的用户名和密码信息。</p></li> <li><p>后台收到后，将用户信息加密之后，返回一个token给前台，同时将该token保存到session中，用于后续请求的校验。</p></li> <li><p>前台收到后台返回的token之后，将该token保存到cookie中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>

<span class="token keyword">const</span> tokenKey <span class="token operator">=</span> <span class="token string">'X-Lobes-Token'</span>

<span class="token keyword">function</span> <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token function">handleLogin</span><span class="token punctuation">(</span><span class="token parameter">loginParam</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span>loginParam<span class="token punctuation">)</span>    <span class="token comment">// login为封装的axios请求，用于登录</span>
    <span class="token function">setToken</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>将token添加到axios请求header中，这样后台就能根据收到的客户端请求里的请求头来确定客户端身份了：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>

<span class="token keyword">const</span> tokenKey <span class="token operator">=</span> <span class="token string">'X-Lobes-Token'</span>

<span class="token keyword">function</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_API</span><span class="token punctuation">,</span>
  timeout<span class="token punctuation">:</span> <span class="token number">50000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'X-Lobes-Token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>客户端成功登录之后，再用收到的token向后台查询用户信息</p></li></ol> <p>之所以整个登录流程客户端会向后台发送两次请求，一是因为这样整个流程比较清晰；二是因为当用户信息有更新时，这种方式可以正常获取到。</p> <ul><li><strong>权限控制</strong></li></ul> <p><strong>通过vue-router的全局前置守卫来实现</strong></p> <p>本项目的权限控制很简单，所有用户能看到的页面都一样。所以只需要判断用户的登录情况就可以了。</p> <p>vue-router的<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html" target="_blank" rel="noopener noreferrer">全局前置守卫<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以获取到浏览器的每一次路由跳转行为，这样就可以很方便地实现权限控制。在路由每一次跳转的时候，判断cookie中是否存在token，如果不存在则跳转到登录页面；如果存在且目标路由为登录页面，则将其路由到主页面。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> iView <span class="token keyword">from</span> <span class="token string">'iview'</span>

<span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">]</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  iView<span class="token punctuation">.</span>LoadingBar<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      iView<span class="token punctuation">.</span>LoadingBar<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> nickname <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>nickname
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nickname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getUserInfo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
      iView<span class="token punctuation">.</span>LoadingBar<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  iView<span class="token punctuation">.</span>LoadingBar<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>另外，可以通过设置路由白名单，让没有登录过的用户也可以访问到特定的页面，比如示例代码中的登陆页面。</p> <h3 id="页面自适应"><a href="#页面自适应" aria-hidden="true" class="header-anchor">#</a> 页面自适应</h3> <blockquote><p>web端页面的分辨率不会像移动端有那么多种情况，本项目使用rem简单处理了页面自适应的问题</p></blockquote> <ul><li><strong>rem处理页面自适应</strong></li></ul> <p>我们知道，rem（font size of the root element）是指相对于根元素的字体大小的单位。那么，如果样式中长度单位都用rem，当页面大小变化时，只需要修改根元素的字体大小，页面的其他部分也就会相应的修改：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">calculateFontSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1920</span> <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">calculateFontSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> calculateFontSize
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>将window的resize监听函数注册在全局Vue的created钩子函数中，就能对所有页面组件生效</strong></p> <ul><li><strong>px2rem-loader将px转换成rem</strong></li></ul> <p>上一步我们知道了使用rem单位可以实现页面自适应，但是在实际开发的过程中，给到我们的设计图的标注一般都是以px为单位的，如果要一个个地计算某段长度等于多少rem，实在是太麻烦。<a href="https://www.npmjs.com/package/px2rem-loader" target="_blank" rel="noopener noreferrer">px2rem-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就解决了这个问题，它可以将指定文件类型中的px单位转换成对应的rem大小，这样就可以在样式中直接写设计图上标记的长度了。</p> <p>vue-cli3中webpack的配置写在vue.config.js文件里，可以像下面这样配置px2rem-loader：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    
    <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'scss'</span><span class="token punctuation">)</span>    <span class="token comment">// 作用在 *.scss文件中</span>
      <span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">'postcss-loader'</span><span class="token punctuation">)</span> <span class="token comment">// px2rem-loader放在postcss-loader之前，确加载顺序正确</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        remUnit<span class="token punctuation">:</span> <span class="token number">20</span>    <span class="token comment">// 这里remUnit的值表示1rem=20px</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h3 id="优雅地使用icon"><a href="#优雅地使用icon" aria-hidden="true" class="header-anchor">#</a> 优雅地使用icon</h3> <blockquote><p>本项目icon的使用方式为<a href="https://www.iconfont.cn/" target="_blank" rel="noopener noreferrer">iconfront<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="https://github.com/MMF-FE/vue-svgicon" target="_blank" rel="noopener noreferrer">vue-svgicon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>说起icon，可能大多数人第一反应就是阿里巴巴的iconfront了。本项目的大多数图标也是在iconfront上找到并由iconfront管理的。iconfront官网上有着比较详细的使用icon的教程，本人也按照官网的方式使用过一段时间，使用下来有两个不太满意的地方：</p> <ol><li>每次更新图标的时候，都需要将官网上项目的图标包全部下下来，然后覆盖本地的图标，无法单个更新；</li> <li>打包之后的文件混在一起，语义不明，无法查看里面包含了什么icon</li></ol> <p><strong>vue-svgicon</strong>则正好解决了这个痛点。具体使用方式可参考<a href="https://github.com/MMF-FE/vue-svgicon" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>本项目在使用的时候，步骤如下：</p> <ol><li>在package.json里新增脚本：</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;svg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vsvg -s ./src/icons/svg -t ./src/icons/components --ext js --es6&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>./src/icons/svg</strong>为图标存放目录，<strong>./src/icons/components</strong>为生成的js文件目录。</p> <ol start="2"><li>当新增一个图标的时候，将其放在相应目录下，运行:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run svg
</code></pre></div><ol start="3"><li>在main.js中全局注册：</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SvgIcon <span class="token keyword">from</span> <span class="token string">'vue-svgicon'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>SvgIcon<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  tagName<span class="token punctuation">:</span> <span class="token string">'svgicon'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>使用：</li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svgicon</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mail<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token comment">&lt;!-- name为相应的图标的名字 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/16/2020, 10:29:32 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/better-call-me-pumpkin/blog/TiDB简述.html" class="prev">
          TiDB简述
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/better-call-me-pumpkin/assets/js/app.99d21adc.js" defer></script><script src="/better-call-me-pumpkin/assets/js/19.1de6cf5c.js" defer></script>
  </body>
</html>
